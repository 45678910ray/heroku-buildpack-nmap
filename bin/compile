#!/bin/bash

BUILD_PATH=$(cd $1 && pwd)
CACHE_PATH=$(mkdir -p $2 && cd $2 && pwd)

NMAP_VERSION="7.60"
if [ -f $3/NMAP_VERSION ]; then
  NMAP_VERSION="$(cat $3/NMAP_VERSION)"
fi

echo "-----> Installing nmap $NMAP_VERSION"
NMAP_ARCHIVE=nmap-$NMAP_VERSION.tar.bz2

cd $CACHE_PATH
if [ ! -f $CACHE_PATH/$NMAP_ARCHIVE ]; then
  curl -s -O https://nmap.org/dist/$NMAP_ARCHIVE
  bzip2 -cd nmap-$NMAP_VERSION.tar.bz2 | tar xvf -

  cd nmap-$NMAP_VERSION
  ./configure --prefix=$BUILD_PATH/bin/nmap
  make
fi

make install
